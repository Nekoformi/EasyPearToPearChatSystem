#!/bin/bash

isDebugMode=0

displayWidth=1920
displayHeight=1080
timeout=120000 # 2 min
beacon=1920000 # 15 ~ 60 sec / 64 nodes

clusterNumber=0

echo "Enter the cluster number for this computer:"
read -p "" clusterNumber

address=$(hostname -I)
number=`printf "%04d" "$((clusterNumber))"`

echo "/// Information:"
echo "=SoT============================================================================"
echo "Cluster address: ${address}"
echo "Cluster number: ${number}"
echo "============================================================================EoT="

clusterAddress_0001="0.0.0.0"
clusterAddress_0002="0.0.0.0"
clusterAddress_0003="0.0.0.0"
clusterAddress_0004="0.0.0.0"

case "$number" in
    "0001" )
        if [[ $isDebugMode -eq 0 ]]; then
            bash ./"TestC.sh" 1 4 4 "$displayWidth" "$displayHeight" "$timeout" "$beacon"
        fi

        echo "/// Next task:"
        echo "=SoT============================================================================"
        echo "Set up cluster 0004."
        echo "============================================================================EoT="
        echo "/// Run the following command on each client:"
        echo "=SoT============================================================================"
        echo "Task 0001:"
        echo "    C0001_U0001:"
        echo "        /connect @00010003000000000000000000000000" # C0002_U0004
        echo "        /delay @00010003000000000000000000000000 222" # C0002_U0004
        echo "    C0001_U0005:"
        echo "        /connect @00010007000000000000000000000000" # C0002_U0008
        echo "        /delay @00010007000000000000000000000000 222" # C0002_U0008
        echo "    C0001_U0009:"
        echo "        /connect @0001000b000000000000000000000000" # C0002_U0012
        echo "        /delay @0001000b000000000000000000000000 222" # C0002_U0012
        echo "    C0001_U0013:"
        echo "        /connect @0001000f000000000000000000000000" # C0002_U0016
        echo "        /delay @0001000f000000000000000000000000 222" # C0002_U0016
        echo "--------------------------------------------------------------------------------"
        echo "Task 0005:"
        echo "    C0001_U0004:"
        echo "        /delay @00030000000000000000000000000000 98" # C0004_U0001
        echo "    C0001_U0008:"
        echo "        /delay @00030004000000000000000000000000 98" # C0004_U0005
        echo "    C0001_U0012:"
        echo "        /delay @00030008000000000000000000000000 98" # C0004_U0009
        echo "    C0001_U0016:"
        echo "        /delay @0003000c000000000000000000000000 98" # C0004_U0013
        echo "============================================================================EoT=";;
    "0002" )
        if [[ $isDebugMode -eq 0 ]]; then
            echo "Enter the IP address of cluster 0003:"
            read -p "" clusterAddress_0003

            bash ./"TestC.sh" 2 4 4 "$displayWidth" "$displayHeight" "$timeout" "$beacon" "${clusterAddress_0003}:20004"
        fi

        echo "/// Next task:"
        echo "=SoT============================================================================"
        echo "Set up each client."
        echo "============================================================================EoT="
        echo "/// Run the following command on each client:"
        echo "=SoT============================================================================"
        echo "Task 0004:"
        echo "    C0002_U0001:"
        echo "        /connect @00020003000000000000000000000000" # C0003_U0004
        echo "        /delay @00020003000000000000000000000000 87" # C0003_U0004
        echo "    C0002_U0005:"
        echo "        /connect @00020007000000000000000000000000" # C0003_U0008
        echo "        /delay @00020007000000000000000000000000 87" # C0003_U0008
        echo "    C0002_U0009:"
        echo "        /connect @0002000b000000000000000000000000" # C0003_U0012
        echo "        /delay @0002000b000000000000000000000000 87" # C0003_U0012
        echo "    C0002_U0013:"
        echo "        /connect @0002000f000000000000000000000000" # C0003_U0016
        echo "        /delay @0002000f000000000000000000000000 87" # C0003_U0016
        echo "--------------------------------------------------------------------------------"
        echo "Task 0008:"
        echo "    C0002_U0004:"
        echo "        /delay @00000000000000000000000000000000 222" # C0001_U0001
        echo "    C0002_U0008:"
        echo "        /delay @00000004000000000000000000000000 222" # C0001_U0005
        echo "    C0002_U0012:"
        echo "        /delay @00000008000000000000000000000000 222" # C0001_U0009
        echo "    C0002_U0016:"
        echo "        /delay @0000000c000000000000000000000000 222" # C0001_U0013
        echo "============================================================================EoT=";;
    "0003" )
        if [[ $isDebugMode -eq 0 ]]; then
            echo "Enter the IP address of cluster 0004:"
            read -p "" clusterAddress_0004

            bash ./"TestC.sh" 3 4 4 "$displayWidth" "$displayHeight" "$timeout" "$beacon" "${clusterAddress_0004}:20004"
        fi

        echo "/// Next task:"
        echo "=SoT============================================================================"
        echo "Set up cluster 0002."
        echo "============================================================================EoT="
        echo "/// Run the following command on each client:"
        echo "=SoT============================================================================"
        echo "Task 0003:"
        echo "    C0003_U0001:"
        echo "        /connect @00030003000000000000000000000000" # C0004_U0004
        echo "        /delay @00030003000000000000000000000000 63" # C0004_U0004
        echo "    C0003_U0005:"
        echo "        /connect @00030007000000000000000000000000" # C0004_U0008
        echo "        /delay @00030007000000000000000000000000 63" # C0004_U0008
        echo "    C0003_U0009:"
        echo "        /connect @0003000b000000000000000000000000" # C0004_U0012
        echo "        /delay @0003000b000000000000000000000000 63" # C0004_U0012
        echo "    C0003_U0013:"
        echo "        /connect @0003000f000000000000000000000000" # C0004_U0016
        echo "        /delay @0003000f000000000000000000000000 63" # C0004_U0016
        echo "--------------------------------------------------------------------------------"
        echo "Task 0007:"
        echo "    C0003_U0004:"
        echo "        /delay @00010000000000000000000000000000 87" # C0002_U0001
        echo "    C0003_U0008:"
        echo "        /delay @00010004000000000000000000000000 87" # C0002_U0005
        echo "    C0003_U0012:"
        echo "        /delay @00010008000000000000000000000000 87" # C0002_U0009
        echo "    C0003_U0016:"
        echo "        /delay @0001000c000000000000000000000000 87" # C0002_U0013
        echo "============================================================================EoT=";;
    "0004" )
        if [[ $isDebugMode -eq 0 ]]; then
            echo "Enter the IP address of cluster 0001:"
            read -p "" clusterAddress_0001

            bash ./"TestC.sh" 4 4 4 "$displayWidth" "$displayHeight" "$timeout" "$beacon" "${clusterAddress_0001}:20004"
        fi

        echo "/// Next task:"
        echo "=SoT============================================================================"
        echo "Set up cluster 0003."
        echo "============================================================================EoT="
        echo "/// Run the following command on each client:"
        echo "=SoT============================================================================"
        echo "Task 0002:"
        echo "    C0004_U0001:"
        echo "        /connect @00000003000000000000000000000000" # C0001_U0004
        echo "        /delay @00000003000000000000000000000000 98" # C0001_U0004
        echo "    C0004_U0005:"
        echo "        /connect @00000007000000000000000000000000" # C0001_U0008
        echo "        /delay @00000007000000000000000000000000 98" # C0001_U0008
        echo "    C0004_U0009:"
        echo "        /connect @0000000b000000000000000000000000" # C0001_U0012
        echo "        /delay @0000000b000000000000000000000000 98" # C0001_U0012
        echo "    C0004_U0013:"
        echo "        /connect @0000000f000000000000000000000000" # C0001_U0016
        echo "        /delay @0000000f000000000000000000000000 98" # C0001_U0016
        echo "--------------------------------------------------------------------------------"
        echo "Task 0006:"
        echo "    C0004_U0004:"
        echo "        /delay @00020000000000000000000000000000 63" # C0003_U0001
        echo "    C0004_U0008:"
        echo "        /delay @00020004000000000000000000000000 63" # C0003_U0005
        echo "    C0004_U0012:"
        echo "        /delay @00020008000000000000000000000000 63" # C0003_U0009
        echo "    C0004_U0016:"
        echo "        /delay @0002000c000000000000000000000000 63" # C0003_U0013
        echo "============================================================================EoT=";;
    * )
        echo "Please enter a cluster number between 1 and 4.";;
esac
